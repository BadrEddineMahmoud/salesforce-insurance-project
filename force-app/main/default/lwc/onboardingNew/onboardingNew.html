<template>
    <div class="compact-form">
    <lightning-card>
        <!-- STEP: ACCOUNT -->
        <template if:true={isAccountStep}>
            <div class="step-header">
                <h2 class="step-title">Step 1: Account Information</h2>
            </div>
            <div class="slds-p-around_medium compact-section slds-grid slds-wrap slds-gutters compact-grid compact-input">
                <div class="slds-col slds-size_1-of-1">
                    <lightning-radio-group
                        label="Client Type"
                        options={clientTypeOptions}
                        value={dto.clientType}
                        required
                        name="clientType"
                        type="radio"
                        onchange={handleClientTypeChange}>
                    </lightning-radio-group>
                </div>

                <!-- Person -->
                <template if:true={isPerson}>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input name="firstName" label="First Name" value={dto.firstName} onchange={handleInputChange} required></lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input name="lastName" label="Last Name" value={dto.lastName} onchange={handleInputChange} required></lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input type="date" name="birthDate" label="Birth Date" value={dto.birthDate} onchange={handleInputChange}></lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input name="driverLicense" label="Driver License" value={dto.driverLicense} onchange={handleInputChange}></lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input type="date" name="licenseIssuanceDate" label="License Issuance Date" value={dto.licenseIssuanceDate} onchange={handleInputChange}></lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-combobox
                            name="categoryLicense"
                            label="License Category"
                            value={dto.categoryLicense}
                            placeholder="Select License Category"
                            options={categoryLicenseOptions}
                            onchange={handleInputChange}>
                        </lightning-combobox>
                    </div>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input name="nationalId" label="National ID" value={dto.nationalId} onchange={handleInputChange}></lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input type="email" name="email" label="Email" value={dto.email} onchange={handleInputChange}></lightning-input>
                    </div>
                </template>

                <!-- Business -->
                <template if:true={isBusiness}>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input name="businessName" label="Business Name" value={dto.businessName} onchange={handleInputChange} required></lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input name="registerOfCommerce" label="Register of Commerce" value={dto.registerOfCommerce} onchange={handleInputChange}></lightning-input>
                    </div>
                </template>

                <!-- Common contact fields -->
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="phoneNumber" label="Phone" value={dto.phoneNumber} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="city" label="City" value={dto.city} onchange={handleInputChange}></lightning-input>
                </div>

                <div class="slds-col slds-size_1-of-1 button-group">
                    <lightning-button variant="neutral" label="Back" onclick={handleBack} disabled={isFirstStep}></lightning-button>
                    <lightning-button variant="brand" label="Next Step" onclick={handleNext} icon-name="utility:forward"></lightning-button>
                </div>
            </div>
        </template>

        <!-- STEP: DRIVER (Business only) -->
        <template if:true={isDriverStep}>
            <div class="step-header">
                <h2 class="step-title">Step 2: Driver Information</h2>
            </div>
            <div class="slds-p-around_medium compact-section slds-grid slds-wrap slds-gutters compact-grid compact-input">
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="driverFirstName" label="Driver First Name" value={dto.driverFirstName} onchange={handleInputChange} required></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="driverLastName" label="Driver Last Name" value={dto.driverLastName} onchange={handleInputChange} required></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input type="date" name="birthDate" label="Birth Date" value={dto.birthDate} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="driverLicense" label="Driver License" value={dto.driverLicense} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input type="date" name="licenseIssuanceDate" label="License Issuance Date" value={dto.licenseIssuanceDate} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="nationalId" label="National ID" value={dto.nationalId} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input type="email" name="email" label="Email" value={dto.email} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-combobox
                        name="categoryLicense"
                        label="License Category"
                        value={dto.categoryLicense}
                        placeholder="Select License Category"
                        options={categoryLicenseOptions}
                        onchange={handleInputChange}>
                    </lightning-combobox>
                </div>

                <div class="slds-col slds-size_1-of-1 button-group">
                    <lightning-button variant="neutral" label="Back" onclick={handleBack}></lightning-button>
                    <lightning-button variant="brand" label="Next Step" onclick={handleNext} icon-name="utility:forward"></lightning-button>
                </div>
            </div>
        </template>

        <!-- STEP: VEHICLE -->
        <template if:true={isVehicleStep}>
            <div class="step-header">
                <h2 class="step-title">Vehicle Information</h2>
            </div>
            <div class="slds-p-around_medium compact-section slds-grid slds-wrap slds-gutters compact-grid compact-input">
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="vehiclePlate" label="Vehicle Plate" value={dto.vehiclePlate} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input type="checkbox" name="vehicleIsNew" label="Is New?" checked={dto.vehicleIsNew} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input type="date" name="vehicleStartDateOfCirculation" label="Start Date of Circulation" value={dto.vehicleStartDateOfCirculation} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-combobox
                        name="vehicleBodyType"
                        label="Body Type"
                        value={dto.vehicleBodyType}
                        placeholder="Select Body Type"
                        options={bodyTypeOptions}
                        onchange={handleInputChange}>
                    </lightning-combobox>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input type="number" name="vehicleNumberOfPassengers" label="Number of Passengers" value={dto.vehicleNumberOfPassengers} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="vehicleBrand" label="Brand" value={dto.vehicleBrand} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input type="number" name="vehicleCylinder" label="Cylinder" value={dto.vehicleCylinder} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input type="number" name="vehicleFiscalHorsepower" label="Fiscal Horsepower" value={dto.vehicleFiscalHorsepower} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-combobox
                        name="vehicleUsage"
                        label="Usage"
                        value={dto.vehicleUsage}
                        placeholder="Select Usage"
                        options={vehicleUsageOptions}
                        onchange={handleInputChange}>
                    </lightning-combobox>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-combobox
                        name="vehicleMake"
                        label="Make"
                        value={dto.vehicleMake}
                        placeholder="Select Make"
                        options={makeOptions}
                        onchange={handleInputChange}>
                    </lightning-combobox>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="vehicleModel" label="Model" value={dto.vehicleModel} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-combobox
                        name="vehicleFuelType"
                        label="Fuel Type"
                        value={dto.vehicleFuelType}
                        placeholder="Select Fuel Type"
                        options={fuelTypeOptions}
                        onchange={handleInputChange}>
                    </lightning-combobox>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input type="checkbox" name="vehicleTrailer" label="Has Trailer?" checked={dto.vehicleTrailer} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input type="number" name="vehicleValue" label="Estimated Value" value={dto.vehicleValue} onchange={handleInputChange}></lightning-input>
                </div>

                <div class="slds-col slds-size_1-of-1 button-group">
                    <lightning-button variant="neutral" label="Back" onclick={handleBack}></lightning-button>
                    <lightning-button variant="brand" label="Next Step" onclick={handleNext} icon-name="utility:forward"></lightning-button>
                </div>
            </div>
        </template>

        <!-- STEP: REVIEW -->
        <template if:true={isReviewStep}>
            <div class="step-header">
                <h2 class="step-title">Review Your Information</h2>
                <p class="step-subtitle">Please verify all details before proceeding</p>
            </div>
            <div class="slds-p-around_medium compact-section">
                
                <!-- Account Information -->
                <div class="review-section">
                    <h3 class="review-section-title">
                        <lightning-icon icon-name="standard:account" size="small"></lightning-icon>
                        Account Information
                    </h3>
                    <div class="review-grid">
                        <template if:true={isPerson}>
                            <div class="review-item">
                                <span class="review-label">Name:</span> {dto.firstName} {dto.lastName}
                            </div>
                            <div class="review-item">
                                <span class="review-label">Birth Date:</span> {dto.birthDate}
                            </div>
                            <div class="review-item">
                                <span class="review-label">Driver License:</span> {dto.driverLicense}
                            </div>
                            <div class="review-item">
                                <span class="review-label">National ID:</span> {dto.nationalId}
                            </div>
                        </template>
                        
                        <template if:true={isBusiness}>
                            <div class="review-item">
                                <span class="review-label">Business Name:</span> {dto.businessName}
                            </div>
                            <div class="review-item">
                                <span class="review-label">Register of Commerce:</span> {dto.registerOfCommerce}
                            </div>
                        </template>
                        
                        <div class="review-item">
                            <span class="review-label">Phone:</span> {dto.phoneNumber}
                        </div>
                        <div class="review-item">
                            <span class="review-label">City:</span> {dto.city}
                        </div>
                        <div class="review-item">
                            <span class="review-label">Email:</span> {dto.email}
                        </div>
                    </div>
                </div>
                
                <!-- Driver Information (Business only) -->
                <template if:true={isBusiness}>
                    <div class="review-section">
                        <h3 class="review-section-title">
                            <lightning-icon icon-name="standard:contact" size="small"></lightning-icon>
                            Driver Information
                        </h3>
                        <div class="review-grid">
                            <div class="review-item">
                                <span class="review-label">Name:</span> {dto.driverFirstName} {dto.driverLastName}
                            </div>
                            <div class="review-item">
                                <span class="review-label">Birth Date:</span> {dto.birthDate}
                            </div>
                            <div class="review-item">
                                <span class="review-label">Driver License:</span> {dto.driverLicense}
                            </div>
                            <div class="review-item">
                                <span class="review-label">National ID:</span> {dto.nationalId}
                            </div>
                            <div class="review-item">
                                <span class="review-label">License Category:</span> {dto.categoryLicense}
                            </div>
                        </div>
                    </div>
                </template>
                
                <!-- Vehicle Information -->
                <div class="review-section">
                    <h3 class="review-section-title">
                        <lightning-icon icon-name="custom:custom26" size="small"></lightning-icon>
                        Vehicle Information
                    </h3>
                    <div class="review-grid">
                        <div class="review-item">
                            <span class="review-label">Plate:</span> {dto.vehiclePlate}
                        </div>
                        <div class="review-item">
                            <span class="review-label">Is New:</span> {vehicleIsNewLabel}
                        </div>
                        <div class="review-item">
                            <span class="review-label">Brand:</span> {dto.vehicleBrand}
                        </div>
                        <div class="review-item">
                            <span class="review-label">Model:</span> {dto.vehicleModel}
                        </div>
                        <div class="review-item">
                            <span class="review-label">Make:</span> {dto.vehicleMake}
                        </div>
                        <div class="review-item">
                            <span class="review-label">Body Type:</span> {dto.vehicleBodyType}
                        </div>
                        <div class="review-item">
                            <span class="review-label">Fuel Type:</span> {dto.vehicleFuelType}
                        </div>
                        <div class="review-item">
                            <span class="review-label">Usage:</span> {dto.vehicleUsage}
                        </div>
                        <div class="review-item">
                            <span class="review-label">Fiscal Horsepower:</span> {dto.vehicleFiscalHorsepower}
                        </div>
                        <div class="review-item">
                            <span class="review-label">Cylinder:</span> {dto.vehicleCylinder}
                        </div>
                        <div class="review-item">
                            <span class="review-label">Passengers:</span> {dto.vehicleNumberOfPassengers}
                        </div>
                        <div class="review-item">
                            <span class="review-label">Value at new:</span> {vehicleValueFormatted}
                        </div>
                        <div class="review-item">
                            <span class="review-label">Has Trailer:</span> {vehicleTrailerLabel}
                        </div>
                        <div class="review-item">
                            <span class="review-label">Start Date:</span> {dto.vehicleStartDateOfCirculation}
                        </div>
                    </div>
                </div>
                
                <div class="button-group">
                    <lightning-button variant="neutral" label="Back" onclick={handleBack}></lightning-button>
                    <lightning-button variant="brand" label="Next Step" onclick={handleNext} icon-name="utility:forward"></lightning-button>
                </div>
            </div>
        </template>

        <!-- STEP: COVERAGES -->
        <template if:true={isCoveragesStep}>
            <div class="step-header">
                <h2 class="step-title">Select Coverage Options</h2>
            </div>
            <div class="slds-p-around_medium compact-section">
                
                <!-- Contract Period Selection -->
                <div class="slds-m-bottom_medium">
                    <lightning-radio-group
                        name="contractPeriod"
                        label="Contract Period"
                        options={periodOptions}
                        value={dto.contractPeriod}
                        onchange={handlePeriodChange}
                        required>
                    </lightning-radio-group>
                </div>

                <!-- Coverage Selection -->
                <lightning-dual-listbox
                    name="coverages"
                    label="Select Coverages"
                    source-label="Available"
                    selected-label="Selected"
                    field-level-help="Choose applicable coverages"
                    options={coverageOptions}
                    value={dto.selectedCoverageIds}
                    onchange={handleCoveragesChange}>
                </lightning-dual-listbox>

                <div class="button-group">
                    <lightning-button variant="neutral" label="Back" onclick={handleBack}></lightning-button>
                    <lightning-button variant="brand" label="Next Step" onclick={handleNext} icon-name="utility:forward"></lightning-button>
                </div>
            </div>
        </template>

        <!-- STEP: FINALIZE (Payment Confirmation + Activation) -->
        <template if:true={isFinalizeStep}>
            <div class="step-header">
                <h2 class="step-title">Payment Confirmation</h2>
                <p class="step-subtitle">Review premium and activate your policy</p>
            </div>
            <div class="slds-p-around_medium compact-section">

                <!-- Premium Summary Box -->
                <div class="payment-summary">
                    <p style="margin-bottom: 0.5rem; font-size: 1rem; font-weight: 600;">Total Premium</p>
                    <div class="payment-amount">{premiumFormatted}</div>
                </div>

                <!-- Coverage Breakdown Table -->
                <div class="slds-m-bottom_medium">
                    <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                        <lightning-icon icon-name="standard:recipe" size="small"></lightning-icon>
                        Coverage Breakdown
                    </h3>
                    
                    <template if:true={coveragePremiumsArray}>
                        <template if:true={coveragePremiumsArray.length}>
                            <table class="coverage-table">
                                <thead>
                                    <tr>
                                        <th>Coverage</th>
                                        <th style="text-align: right;">Premium</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <template for:each={coveragePremiumsArray} for:item="coverage">
                                        <tr key={coverage.id}>
                                            <td>{coverage.name}</td>
                                            <td style="text-align: right;">{coverage.premium}</td>
                                        </tr>
                                    </template>
                                    <!-- Total Row -->
                                    <tr class="total-row">
                                        <td><strong>Total Premium</strong></td>
                                        <td style="text-align: right;"><strong>{premiumFormatted}</strong></td>
                                    </tr>
                                </tbody>
                            </table>
                        </template>
                        <template if:false={coveragePremiumsArray.length}>
                            <p class="slds-text-color_weak">No coverage breakdown available</p>
                        </template>
                    </template>
                </div>

                <!-- Payment Terms & Activation Notice -->
                <div class="slds-box slds-box_small slds-theme_warning slds-m-bottom_medium">
                    <lightning-icon icon-name="utility:warning" size="x-small" class="slds-m-right_x-small"></lightning-icon>
                    <strong>Important:</strong> By clicking "Confirm Payment & Activate", you agree to the insurance terms, authorize payment of the premium amount, and activate your insurance contract.
                </div>

                <div class="button-group">
                    <lightning-button variant="neutral" label="Back" onclick={handleBack}></lightning-button>
                    <lightning-button variant="success" label="Confirm Payment & Activate" onclick={handleNext} icon-name="utility:check"></lightning-button>
                </div>
            </div>
        </template>

        <!-- STEP: DOWNLOAD -->
        <template if:true={isDownloadStep}>
            <div class="slds-p-around_medium">
                <!-- Success Message -->
                <div class="slds-text-align_center slds-m-bottom_large">
                    <lightning-icon icon-name="action:approval" size="large" class="slds-icon-text-success success-icon"></lightning-icon>
                    <h2 class="slds-text-heading_large slds-m-top_small">Insurance Policy Activated!</h2>
                    <p class="slds-text-color_weak">Your policy has been successfully activated. Download your policy document below.</p>
                </div>

                <!-- Policy Summary for Download -->
                <div class="slds-box policy-document">
                    
                    <!-- Header -->
                    <div class="policy-header" style="text-align: center; border-bottom: 2px solid #000; padding-bottom: 0.75rem; margin-bottom: 1rem;">
                        <h1 class="slds-text-heading_large">Insurance Policy</h1>
                        <p class="slds-text-heading_medium slds-m-top_small">Policy Number: {dto.policyName}</p>
                        <p class="slds-text-heading_medium">Contract Order Number: {dto.contractName}</p>
                    </div>
                    
                    <!-- Legal Header -->
                    <div class="legal-header" style="background-color: #f3f3f3; border: 1px solid #ccc; padding: 0.75rem; margin-bottom: 1rem; font-size: 0.875rem; font-style: italic; line-height: 1.5;">
                        This document constitutes a legally binding insurance agreement between <strong>Saiyan Insurance</strong> ("Insurer") and 
                        <strong><template if:true={isPerson}>{dto.firstName} {dto.lastName}</template><template if:true={isBusiness}>{dto.businessName}</template></strong> ("Policyholder")
                        subject to the terms, conditions, coverage limits, exclusions, and endorsements detailed herein.
                    </div>

                    <!-- Period and Broker in 2-column layout -->
                    <div class="slds-grid slds-wrap slds-gutters_small slds-m-bottom_small">
                        <!-- Left Column: Period and Dates -->
                        <div class="slds-col slds-size_1-of-2">
                            <div class="policy-section">
                                <div class="info-grid">
                                    <div class="info-item"><span class="info-label">Contract Period:</span> {dto.contractPeriod} Months</div>
                                    <div class="info-item"><span class="info-label">Start Date:</span> {contractStartDateFormatted}</div>
                                    <div class="info-item"><span class="info-label">End Date:</span> {contractEndDateFormatted}</div>
                                </div>
                            </div>
                        </div>

                        <!-- Right Column: Broker -->
                        <div class="slds-col slds-size_1-of-2">
                            <div class="policy-section broker-section" style="background: #f9f9f9; border: 1px solid #ddd; padding: 0.5rem;">
                                <strong>Managed By:</strong> {dto.brokerName}
                            </div>
                        </div>
                    </div>

                    <!-- Account/Driver and Vehicle in 2-column layout -->
                    <div class="slds-grid slds-wrap slds-gutters_small">
                        <!-- Left Column: Account and Driver -->
                        <div class="slds-col slds-size_1-of-2">
                            <!-- Account Information -->
                            <div class="policy-section">
                                <h3>Account Information</h3>
                                <div class="info-grid">
                                    <template if:true={isPerson}>
                                        <div class="info-item"><strong>Name:</strong> {dto.firstName} {dto.lastName}</div>
                                        <div class="info-item"><strong>Type:</strong> Person</div>
                                        <div class="info-item"><strong>National ID:</strong> {dto.nationalId}</div>
                                    </template>
                                    <template if:true={isBusiness}>
                                        <div class="info-item"><strong>Business Name:</strong> {dto.businessName}</div>
                                        <div class="info-item"><strong>Type:</strong> Business</div>
                                        <div class="info-item"><strong>Register of Commerce:</strong> {dto.registerOfCommerce}</div>
                                    </template>
                                    <div class="info-item"><strong>City:</strong> {dto.city}</div>
                                    <div class="info-item"><strong>Phone:</strong> {dto.phoneNumber}</div>
                                    <div class="info-item"><strong>Email:</strong> {dto.email}</div>
                                </div>
                            </div>

                            <!-- Driver Information (if Business) -->
                            <template if:true={isBusiness}>
                                <div class="policy-section">
                                    <h3>Driver Information</h3>
                                    <div class="info-grid">
                                        <div class="info-item"><strong>Name:</strong> {dto.driverFirstName} {dto.driverLastName}</div>
                                        <div class="info-item"><strong>Birth Date:</strong> {dto.birthDate}</div>
                                        <div class="info-item"><strong>Driver License:</strong> {dto.driverLicense}</div>
                                        <div class="info-item"><strong>License Category:</strong> {dto.categoryLicense}</div>
                                        <div class="info-item"><strong>License Issuance Date:</strong> {dto.licenseIssuanceDate}</div>
                                    </div>
                                </div>
                            </template>

                            <!-- Driver Info for Person -->
                            <template if:true={isPerson}>
                                <div class="policy-section">
                                    <h3>Driver Information</h3>
                                    <div class="info-grid">
                                        <div class="info-item"><strong>Birth Date:</strong> {dto.birthDate}</div>
                                        <div class="info-item"><strong>Driver License:</strong> {dto.driverLicense}</div>
                                        <div class="info-item"><strong>License Category:</strong> {dto.categoryLicense}</div>
                                        <div class="info-item"><strong>License Issuance Date:</strong> {dto.licenseIssuanceDate}</div>
                                    </div>
                                </div>
                            </template>
                        </div>

                        <!-- Right Column: Vehicle -->
                        <div class="slds-col slds-size_1-of-2">
                            <div class="policy-section">
                                <h3>Vehicle Information</h3>
                                <div class="info-grid">
                                    <div class="info-item"><strong>Plate Number:</strong> {dto.vehiclePlate}</div>
                                    <div class="info-item"><strong>Start Date of Circulation:</strong> {dto.vehicleStartDateOfCirculation}</div>
                                    <div class="info-item"><strong>Body Type:</strong> {dto.vehicleBodyType}</div>
                                    <div class="info-item"><strong>Number of Passengers:</strong> {dto.vehicleNumberOfPassengers}</div>
                                    <div class="info-item"><strong>Usage:</strong> {dto.vehicleUsage}</div>
                                    <div class="info-item"><strong>Fiscal Horsepower:</strong> {dto.vehicleFiscalHorsepower}</div>
                                    <div class="info-item"><strong>Make:</strong> {dto.vehicleMake}</div>
                                    <div class="info-item"><strong>Model:</strong> {dto.vehicleModel}</div>
                                    <div class="info-item"><strong>Fuel Type:</strong> {dto.vehicleFuelType}</div>
                                    <div class="info-item"><strong>Trailer:</strong> {vehicleTrailerLabel}</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Coverage Details -->
                    <div class="policy-section">
                        <h3>Coverage Details</h3>
                        <table class="coverage-table">
                            <thead>
                                <tr>
                                    <th>Coverage Name</th>
                                    <th style="text-align: right;">Limit</th>
                                    <th style="text-align: right;">Premium</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template for:each={dto.coverageDetails} for:item="coverage">
                                    <tr key={coverage.coverageName}>
                                        <td>{coverage.coverageName}</td>
                                        <td style="text-align: right;">{coverage.coverageLimit}</td>
                                        <td style="text-align: right;">{coverage.coveragePremium}</td>
                                    </tr>
                                </template>
                                <tr class="total-row">
                                    <td colspan="2"><strong>Total Premium</strong></td>
                                    <td style="text-align: right;"><strong>{premiumFormatted}</strong></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Issuance and Signatures -->
                    <div class="signatures-section" style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 2px solid #000;">
                        <!-- Issued Information -->
                        <div class="issuance-info" style="margin-bottom: 1rem;">
                            <p><strong>Issued at:</strong> {dto.city}</p>
                            <p><strong>Date of Issue:</strong> {contractStartDateFormatted}</p>
                        </div>

                        <div class="slds-grid slds-wrap slds-gutters_medium">
                            <!-- Insurer Signature -->
                            <div class="slds-col slds-size_1-of-2">
                                <div class="signature-box" style="border: 1px solid #ccc; padding: 0.75rem; background: #fafafa;">
                                    <p style="margin-bottom: 0.5rem;"><strong>For the Insurer:</strong></p>
                                    <p style="margin-bottom: 0.5rem;"><strong>Name:</strong> Saiyan Insurance</p>
                                    <p style="margin-top: 1.5rem;">
                                        <strong>Signature & Stamp:</strong> 
                                        <span class="signature-line" style="display: inline-block; border-bottom: 1px solid #000; width: 150px; margin-left: 10px;"></span>
                                    </p>
                                </div>
                            </div>

                            <!-- Policyholder Signature -->
                            <div class="slds-col slds-size_1-of-2">
                                <div class="signature-box" style="border: 1px solid #ccc; padding: 0.75rem; background: #fafafa;">
                                    <p style="margin-bottom: 0.5rem;"><strong>The Policyholder:</strong></p>
                                    <p style="margin-bottom: 0.5rem;">
                                        <strong>Name:</strong> 
                                        <template if:true={isPerson}>{dto.firstName} {dto.lastName}</template>
                                        <template if:true={isBusiness}>{dto.businessName}</template>
                                    </p>
                                    <p style="margin-top: 1.5rem;">
                                        <strong>Signature:</strong> 
                                        <span class="signature-line" style="display: inline-block; border-bottom: 1px solid #000; width: 150px; margin-left: 10px;"></span>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Legal Footer -->
                    <div class="legal-header" style=" border: 1px solid #ccc; padding: 0.75rem; margin-bottom: 1rem; font-size: 0.875rem; font-style: italic; line-height: 1.5;">
                        Saiyan Insurance - A company governed by Law No. 17-99 establishing the Insurance Code.
                        Public limited company (Société Anonyme) with a share capital of MAD 602,835,910.00.
                        Commercial Register (RC) Casablanca: 164123 - CNSS: 1090109 - ICE: 001502100047.

                        Head Office: 110, Boulevard Ghandi, Casablanca / Tel: +212 5 22 17 16 01 / +212 5 22 95 74 74
                        Website: www.SaiyanInssurans.com
                    </div>
                </div>

                <!-- Download Button -->
                <div class="slds-m-top_medium slds-text-align_center button-group">
                    <lightning-button variant="brand" label="Download Policy Document" onclick={handleDownload} icon-name="utility:download"></lightning-button>
                    <lightning-button variant="neutral" label="Done" onclick={handleDone}></lightning-button>
                </div>
            </div>
        </template>

        <!-- ERROR -->
        <template if:true={errorMessage}>
            <div class="slds-text-color_error slds-p-around_small" style="background: #fef5f5; border: 1px solid #ea001e; border-radius: 0.25rem; margin: 1rem;">
                <lightning-icon icon-name="utility:error" size="small" variant="error" class="slds-m-right_x-small"></lightning-icon>
                {errorMessage}
            </div>
        </template>
    </lightning-card>
    </div>
</template>
