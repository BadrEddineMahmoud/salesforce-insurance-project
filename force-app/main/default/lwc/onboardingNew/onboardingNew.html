<template>
    <lightning-card title="Insurance Onboarding">
        <!-- STEP: ACCOUNT -->
        <template if:true={isAccountStep}>
            <div class="slds-p-around_medium slds-grid slds-wrap slds-gutters">
                <div class="slds-col slds-size_1-of-1">
                    <lightning-radio-group
                        label="Client Type"
                        options={clientTypeOptions}
                        value={dto.clientType}
                        required
                        name="clientType"
                        type="radio"
                        onchange={handleClientTypeChange}>
                    </lightning-radio-group>
                </div>

                <!-- Person -->
                <template if:true={isPerson}>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input name="firstName" label="First Name" value={dto.firstName} onchange={handleInputChange} required></lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input name="lastName" label="Last Name" value={dto.lastName} onchange={handleInputChange} required></lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input type="date" name="birthDate" label="Birth Date" value={dto.birthDate} onchange={handleInputChange}></lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input name="driverLicense" label="Driver License" value={dto.driverLicense} onchange={handleInputChange}></lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input type="date" name="licenseIssuanceDate" label="License Issuance Date" value={dto.licenseIssuanceDate} onchange={handleInputChange}></lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input name="categoryLicense" label="License Category" value={dto.categoryLicense} onchange={handleInputChange}></lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input name="nationalId" label="National ID" value={dto.nationalId} onchange={handleInputChange}></lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input type="email" name="email" label="Email" value={dto.email} onchange={handleInputChange}></lightning-input>
                    </div>
                </template>

                <!-- Business -->
                <template if:true={isBusiness}>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input name="businessName" label="Business Name" value={dto.businessName} onchange={handleInputChange} required></lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input name="registerOfCommerce" label="Register of Commerce" value={dto.registerOfCommerce} onchange={handleInputChange}></lightning-input>
                    </div>
                </template>

                <!-- Common contact fields -->
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="phoneNumber" label="Phone" value={dto.phoneNumber} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="city" label="City" value={dto.city} onchange={handleInputChange}></lightning-input>
                </div>

                <div class="slds-col slds-size_1-of-1 slds-m-top_medium">
                    <lightning-button variant="neutral" label="Back" onclick={handleBack} disabled={isFirstStep} class="slds-m-right_small"></lightning-button>
                    <lightning-button variant="brand" label="Next" onclick={handleNext}></lightning-button>
                </div>
            </div>
        </template>

        <!-- STEP: DRIVER (Business only) -->
        <template if:true={isDriverStep}>
            <div class="slds-p-around_medium slds-grid slds-wrap slds-gutters">
                <div class="slds-col slds-size_1-of-1">
                    <h3 class="slds-text-heading_medium slds-m-bottom_small">Driver Information</h3>
                </div>
                
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="driverFirstName" label="Driver First Name" value={dto.driverFirstName} onchange={handleInputChange} required></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="driverLastName" label="Driver Last Name" value={dto.driverLastName} onchange={handleInputChange} required></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input type="date" name="birthDate" label="Birth Date" value={dto.birthDate} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="driverLicense" label="Driver License" value={dto.driverLicense} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input type="date" name="licenseIssuanceDate" label="License Issuance Date" value={dto.licenseIssuanceDate} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="nationalId" label="National ID" value={dto.nationalId} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input type="email" name="email" label="Email" value={dto.email} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="categoryLicense" label="License Category" value={dto.categoryLicense} onchange={handleInputChange}></lightning-input>
                </div>

                <div class="slds-col slds-size_1-of-1 slds-m-top_medium">
                    <lightning-button variant="neutral" label="Back" onclick={handleBack} class="slds-m-right_small"></lightning-button>
                    <lightning-button variant="brand" label="Next" onclick={handleNext}></lightning-button>
                </div>
            </div>
        </template>

        <!-- STEP: VEHICLE -->
        <template if:true={isVehicleStep}>
            <div class="slds-p-around_medium slds-grid slds-wrap slds-gutters">
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="vehiclePlate" label="Vehicle Plate" value={dto.vehiclePlate} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input type="checkbox" name="vehicleIsNew" label="Is New?" checked={dto.vehicleIsNew} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input type="date" name="vehicleStartDateOfCirculation" label="Start Date of Circulation" value={dto.vehicleStartDateOfCirculation} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="vehicleBodyType" label="Body Type" value={dto.vehicleBodyType} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input type="number" name="vehicleNumberOfPassengers" label="Number of Passengers" value={dto.vehicleNumberOfPassengers} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="vehicleBrand" label="Brand" value={dto.vehicleBrand} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input type="number" name="vehicleCylinder" label="Cylinder" value={dto.vehicleCylinder} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input type="number" name="vehicleFiscalHorsepower" label="Fiscal Horsepower" value={dto.vehicleFiscalHorsepower} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="vehicleUsage" label="Usage" value={dto.vehicleUsage} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="vehicleMake" label="Make" value={dto.vehicleMake} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="vehicleModel" label="Model" value={dto.vehicleModel} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="vehicleFuelType" label="Fuel Type" value={dto.vehicleFuelType} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input type="checkbox" name="vehicleTrailer" label="Has Trailer?" checked={dto.vehicleTrailer} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input type="number" name="vehicleValue" label="Estimated Value" value={dto.vehicleValue} onchange={handleInputChange}></lightning-input>
                </div>

                <div class="slds-col slds-size_1-of-1 slds-m-top_medium">
                    <lightning-button variant="neutral" label="Back" onclick={handleBack} class="slds-m-right_small"></lightning-button>
                    <lightning-button variant="brand" label="Next" onclick={handleNext}></lightning-button>
                </div>
            </div>
        </template>

        <!-- STEP: REVIEW -->
        <!-- STEP: REVIEW -->
        <template if:true={isReviewStep}>
            <div class="slds-p-around_medium">
                <p class="slds-text-heading_small slds-m-bottom_medium">Review Information</p>
                
                <!-- Account Information -->
                <div class="slds-box slds-m-bottom_medium">
                    <h3 class="slds-text-heading_small slds-m-bottom_small">
                        <lightning-icon icon-name="standard:account" size="small" class="slds-m-right_x-small"></lightning-icon>
                        Account Information
                    </h3>
                    <div class="slds-grid slds-wrap">
                        <template if:true={isPerson}>
                            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                                <strong>Name:</strong> {dto.firstName} {dto.lastName}
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                                <strong>Birth Date:</strong> {dto.birthDate}
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                                <strong>Driver License:</strong> {dto.driverLicense}
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                                <strong>National ID:</strong> {dto.nationalId}
                            </div>
                        </template>
                        
                        <template if:true={isBusiness}>
                            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                                <strong>Business Name:</strong> {dto.businessName}
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                                <strong>Register of Commerce:</strong> {dto.registerOfCommerce}
                            </div>
                        </template>
                        
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>Phone:</strong> {dto.phoneNumber}
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>City:</strong> {dto.city}
                        </div>
                    </div>
                </div>
                
                <!-- Driver Information (Business only) -->
                <template if:true={isBusiness}>
                    <div class="slds-box slds-m-bottom_medium">
                        <h3 class="slds-text-heading_small slds-m-bottom_small">
                            <lightning-icon icon-name="standard:contact" size="small" class="slds-m-right_x-small"></lightning-icon>
                            Driver Information
                        </h3>
                        <div class="slds-grid slds-wrap">
                            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                                <strong>Name:</strong> {dto.driverFirstName} {dto.driverLastName}
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                                <strong>Birth Date:</strong> {dto.birthDate}
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                                <strong>Driver License:</strong> {dto.driverLicense}
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                                <strong>National ID:</strong> {dto.nationalId}
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                                <strong>License Category:</strong> {dto.categoryLicense}
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                                <strong>Email:</strong> {dto.email}
                            </div>
                        </div>
                    </div>
                </template>
                
                <!-- Vehicle Information -->
                <div class="slds-box slds-m-bottom_medium">
                    <h3 class="slds-text-heading_small slds-m-bottom_small">
                        <lightning-icon icon-name="custom:custom26" size="small" class="slds-m-right_x-small"></lightning-icon>
                        Vehicle Information
                    </h3>
                    <div class="slds-grid slds-wrap">
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>Plate:</strong> {dto.vehiclePlate}
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>Is New:</strong> {vehicleIsNewLabel}
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>Brand:</strong> {dto.vehicleBrand}
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>Model:</strong> {dto.vehicleModel}
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>Make:</strong> {dto.vehicleMake}
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>Body Type:</strong> {dto.vehicleBodyType}
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>Fuel Type:</strong> {dto.vehicleFuelType}
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>Usage:</strong> {dto.vehicleUsage}
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>Fiscal Horsepower:</strong> {dto.vehicleFiscalHorsepower}
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>Cylinder:</strong> {dto.vehicleCylinder}
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>Passengers:</strong> {dto.vehicleNumberOfPassengers}
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>Value:</strong> {vehicleValueFormatted}
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>Has Trailer:</strong> {vehicleTrailerLabel}
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>Start Date:</strong> {dto.vehicleStartDateOfCirculation}
                        </div>
                    </div>
                </div>
                
                <div class="slds-m-top_medium">
                    <lightning-button variant="neutral" label="Back" onclick={handleBack} class="slds-m-right_small"></lightning-button>
                    <lightning-button variant="brand" label="Next" onclick={handleNext}></lightning-button>
                </div>
            </div>
        </template>

        <!-- STEP: COVERAGES -->
        <template if:true={isCoveragesStep}>
            <div class="slds-p-around_medium">
                <!-- Contract Period Selection -->
            <div class="slds-m-bottom_medium">
                <lightning-radio-group
                    name="contractPeriod"
                    label="Contract Period"
                    options={periodOptions}
                    value={dto.contractPeriod}
                    onchange={handlePeriodChange}
                    required>
                </lightning-radio-group>
            </div>
                <lightning-dual-listbox
                    name="coverages"
                    label="Select Coverages"
                    source-label="Available"
                    selected-label="Selected"
                    field-level-help="Choose applicable coverages"
                    options={coverageOptions}
                    value={dto.selectedCoverageIds}
                    onchange={handleCoveragesChange}>
                </lightning-dual-listbox>

                <div class="slds-m-top_medium">
                    <lightning-button variant="neutral" label="Back" onclick={handleBack} class="slds-m-right_small"></lightning-button>
                    <lightning-button variant="brand" label="Next" onclick={handleNext}></lightning-button>
                </div>
            </div>
        </template>

        <!-- STEP: FINALIZE -->
        <!-- STEP: FINALIZE (Payment Confirmation + Activation) -->
        <template if:true={isFinalizeStep}>
            <div class="slds-p-around_medium">
                <div class="slds-text-align_center slds-m-bottom_large">
                    <h2 class="slds-text-heading_large">Payment Confirmation & Activation</h2>
                    <p class="slds-text-color_weak">Review your premium and activate your insurance contract</p>
                </div>

                <!-- Premium Summary Box -->
                <div class="slds-box slds-box_small slds-theme_shade slds-m-bottom_medium">
                    <div class="slds-grid slds-grid_vertical-align-center">
                        <div class="slds-col">
                            <h3 class="slds-text-heading_medium">Total Premium</h3>
                        </div>
                        <div class="slds-col slds-text-align_right">
                            <p class="slds-text-heading_large slds-text-color_success">{premiumFormatted}</p>
                        </div>
                    </div>
                </div>

                <!-- Coverage Breakdown Table -->
                <div class="slds-box slds-m-bottom_medium">
                    <h3 class="slds-text-heading_small slds-m-bottom_small">
                        <lightning-icon icon-name="standard:recipe" size="small" class="slds-m-right_x-small"></lightning-icon>
                        Coverage Breakdown
                    </h3>
                    
                    <template if:true={coveragePremiumsArray}>
                        <template if:true={coveragePremiumsArray.length}>
                            <table class="slds-table slds-table_cell-buffer slds-table_bordered">
                                <thead>
                                    <tr class="slds-line-height_reset">
                                        <th scope="col">
                                            <div class="slds-truncate" title="Coverage">Coverage</div>
                                        </th>
                                        <th scope="col" class="slds-text-align_right">
                                            <div class="slds-truncate" title="Premium">Premium</div>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <template for:each={coveragePremiumsArray} for:item="coverage">
                                        <tr key={coverage.id} class="slds-hint-parent">
                                            <td data-label="Coverage">
                                                <div class="slds-truncate" title={coverage.name}>{coverage.name}</div>
                                            </td>
                                            <td data-label="Premium" class="slds-text-align_right">
                                                <div class="slds-truncate" title={coverage.premium}>{coverage.premium}</div>
                                            </td>
                                        </tr>
                                    </template>
                                    <!-- Total Row -->
                                    <tr class="slds-hint-parent slds-theme_shade">
                                        <td data-label="Coverage">
                                            <div class="slds-truncate"><strong>Total Premium</strong></div>
                                        </td>
                                        <td data-label="Premium" class="slds-text-align_right">
                                            <div class="slds-truncate"><strong>{premiumFormatted}</strong></div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </template>
                        <template if:false={coveragePremiumsArray.length}>
                            <p class="slds-text-color_weak">No coverage breakdown available</p>
                        </template>
                    </template>
                </div>

                <!-- Payment Terms & Activation Notice -->
                <div class="slds-box slds-box_small slds-theme_warning slds-m-bottom_medium">
                    <lightning-icon icon-name="utility:warning" size="x-small" class="slds-m-right_x-small"></lightning-icon>
                    <strong>Important:</strong> By clicking "Confirm Payment & Activate", you agree to the insurance terms, authorize payment of the premium amount, and activate your insurance contract.
                </div>

                <div class="slds-m-top_medium">
                    <lightning-button variant="neutral" label="Back" onclick={handleBack} class="slds-m-right_small"></lightning-button>
                    <lightning-button variant="success" label="Confirm Payment & Activate" onclick={handleNext} icon-name="utility:check"></lightning-button>
                </div>
            </div>
        </template>

        <!-- STEP: DOWNLOAD -->
        <template if:true={isDownloadStep}>
            <div class="slds-p-around_medium">
                <!-- Success Message -->
                <div class="slds-text-align_center slds-m-bottom_large">
                    <lightning-icon icon-name="action:approval" size="large" class="slds-icon-text-success"></lightning-icon>
                    <h2 class="slds-text-heading_large slds-m-top_small">Insurance Policy Activated!</h2>
                    <p class="slds-text-color_weak">Your policy has been successfully activated. Download your policy document below.</p>
                </div>

                <!-- Policy Summary for Download -->
                <div class="slds-box slds-m-bottom_medium" id="policy-document">
                    
                    <!-- Header -->
                    <div class="slds-text-align_center slds-m-bottom_large slds-p-bottom_medium" style="border-bottom: 2px solid #ccc;">
                        <h1 class="slds-text-heading_large">Insurance Policy</h1>
                        <p class="slds-text-heading_medium slds-m-top_small">Policy Number: {dto.policyName}</p>
                        <p class="slds-text-heading_medium slds-m-top_small">Contract Order Number: {dto.contractName}</p>
                    </div>
                    <!-- Period -->
                    <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                        <strong>Contract Period:</strong> {dto.contractPeriod} Months
                    </div>
                    <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                        <strong>Start Date:</strong> {contractStartDateFormatted}
                    </div>
                    <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                        <strong>End Date:</strong> {contractEndDateFormatted}
                    </div>

                    <!-- Add after Account Information section -->
                    <div class="slds-m-bottom_large">
                        <h3 class="slds-text-heading_small slds-m-bottom_small" style="border-bottom: 1px solid #ddd; padding-bottom: 5px;">
                            <strong>Broker Information</strong>
                        </h3>
                        <div class="slds-grid slds-wrap slds-gutters_small">
                            <div class="slds-col slds-size_1-of-1 slds-p-vertical_xx-small">
                                <strong>Managed By:</strong> {dto.brokerName}
                            </div>
                        </div>
                    </div>

                    <!-- Account Information -->
                    <div class="slds-m-bottom_large">
                        <h3 class="slds-text-heading_small slds-m-bottom_small" style="border-bottom: 1px solid #ddd; padding-bottom: 5px;">
                            <strong>Account Information</strong>
                        </h3>
                        <div class="slds-grid slds-wrap slds-gutters_small">
                            <template if:true={isPerson}>
                                <div class="slds-col slds-size_1-of-2 slds-p-vertical_xx-small">
                                    <strong>Name:</strong> {dto.firstName} {dto.lastName}
                                </div>
                                <div class="slds-col slds-size_1-of-2 slds-p-vertical_xx-small">
                                    <strong>Type:</strong> Person
                                </div>
                                <div class="slds-col slds-size_1-of-2 slds-p-vertical_xx-small">
                                    <strong>National ID:</strong> {dto.nationalId}
                                </div>
                            </template>
                            <template if:true={isBusiness}>
                                <div class="slds-col slds-size_1-of-2 slds-p-vertical_xx-small">
                                    <strong>Business Name:</strong> {dto.businessName}
                                </div>
                                <div class="slds-col slds-size_1-of-2 slds-p-vertical_xx-small">
                                    <strong>Type:</strong> Business
                                </div>
                                <div class="slds-col slds-size_1-of-2 slds-p-vertical_xx-small">
                                    <strong>Register of Commerce:</strong> {dto.registerOfCommerce}
                                </div>
                            </template>
                            <div class="slds-col slds-size_1-of-2 slds-p-vertical_xx-small">
                                <strong>City:</strong> {dto.city}
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-p-vertical_xx-small">
                                <strong>Phone:</strong> {dto.phoneNumber}
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-p-vertical_xx-small">
                                <strong>Email:</strong> {dto.email}
                            </div>
                        </div>
                    </div>

                    <!-- Driver Information (if Business) -->
                    <template if:true={isBusiness}>
                        <div class="slds-m-bottom_large">
                            <h3 class="slds-text-heading_small slds-m-bottom_small" style="border-bottom: 1px solid #ddd; padding-bottom: 5px;">
                                <strong>Driver Information</strong>
                            </h3>
                            <div class="slds-grid slds-wrap slds-gutters_small">
                                <div class="slds-col slds-size_1-of-2 slds-p-vertical_xx-small">
                                    <strong>Name:</strong> {dto.driverFirstName} {dto.driverLastName}
                                </div>
                                <div class="slds-col slds-size_1-of-2 slds-p-vertical_xx-small">
                                    <strong>Birth Date:</strong> {dto.birthDate}
                                </div>
                                <div class="slds-col slds-size_1-of-2 slds-p-vertical_xx-small">
                                    <strong>Driver License:</strong> {dto.driverLicense}
                                </div>
                                <div class="slds-col slds-size_1-of-2 slds-p-vertical_xx-small">
                                    <strong>License Category:</strong> {dto.categoryLicense}
                                </div>
                                <div class="slds-col slds-size_1-of-2 slds-p-vertical_xx-small">
                                    <strong>License Issuance Date:</strong> {dto.licenseIssuanceDate}
                                </div>
                            </div>
                        </div>
                    </template>

                    <!-- Driver Info for Person -->
                    <template if:true={isPerson}>
                        <div class="slds-m-bottom_large">
                            <h3 class="slds-text-heading_small slds-m-bottom_small" style="border-bottom: 1px solid #ddd; padding-bottom: 5px;">
                                <strong>Driver Information</strong>
                            </h3>
                            <div class="slds-grid slds-wrap slds-gutters_small">
                                <div class="slds-col slds-size_1-of-2 slds-p-vertical_xx-small">
                                    <strong>Birth Date:</strong> {dto.birthDate}
                                </div>
                                <div class="slds-col slds-size_1-of-2 slds-p-vertical_xx-small">
                                    <strong>Driver License:</strong> {dto.driverLicense}
                                </div>
                                <div class="slds-col slds-size_1-of-2 slds-p-vertical_xx-small">
                                    <strong>License Issuance Date:</strong> {dto.licenseIssuanceDate}
                                </div>
                            </div>
                        </div>
                    </template>

                    <!-- Vehicle Information -->
                    <div class="slds-m-bottom_large">
                        <h3 class="slds-text-heading_small slds-m-bottom_small" style="border-bottom: 1px solid #ddd; padding-bottom: 5px;">
                            <strong>Vehicle Information</strong>
                        </h3>
                        <div class="slds-grid slds-wrap slds-gutters_small">
                            <div class="slds-col slds-size_1-of-2 slds-p-vertical_xx-small">
                                <strong>Plate Number:</strong> {dto.vehiclePlate}
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-p-vertical_xx-small">
                                <strong>Start Date of Circulation:</strong> {dto.vehicleStartDateOfCirculation}
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-p-vertical_xx-small">
                                <strong>Body Type:</strong> {dto.vehicleBodyType}
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-p-vertical_xx-small">
                                <strong>Number of Passengers:</strong> {dto.vehicleNumberOfPassengers}
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-p-vertical_xx-small">
                                <strong>Usage:</strong> {dto.vehicleUsage}
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-p-vertical_xx-small">
                                <strong>Fiscal Horsepower:</strong> {dto.vehicleFiscalHorsepower}
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-p-vertical_xx-small">
                                <strong>Make:</strong> {dto.vehicleMake}
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-p-vertical_xx-small">
                                <strong>Model:</strong> {dto.vehicleModel}
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-p-vertical_xx-small">
                                <strong>Fuel Type:</strong> {dto.vehicleFuelType}
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-p-vertical_xx-small">
                                <strong>Trailer:</strong> {vehicleTrailerLabel}
                            </div>
                        </div>
                    </div>

                    <!-- Coverage Details -->
                    <div class="slds-m-bottom_large">
                        <h3 class="slds-text-heading_small slds-m-bottom_small" style="border-bottom: 1px solid #ddd; padding-bottom: 5px;">
                            <strong>Coverage Details</strong>
                        </h3>
                        <table class="slds-table slds-table_cell-buffer slds-table_bordered">
                            <thead>
                                <tr>
                                    <th scope="col">Coverage Name</th>
                                    <th scope="col" class="slds-text-align_right">Limit</th>
                                    <th scope="col" class="slds-text-align_right">Premium</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template for:each={dto.coverageDetails} for:item="coverage">
                                    <tr key={coverage.coverageName}>
                                        <td>{coverage.coverageName}</td>
                                        <td class="slds-text-align_right">{coverage.coverageLimit}</td>
                                        <td class="slds-text-align_right">{coverage.coveragePremium}</td>
                                    </tr>
                                </template>
                                <tr class="slds-theme_shade">
                                    <td colspan="2"><strong>Total Premium</strong></td>
                                    <td class="slds-text-align_right"><strong>{premiumFormatted}</strong></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Footer -->
                    <div class="slds-text-align_center slds-m-top_large slds-p-top_medium" style="border-top: 2px solid #ccc;">
                        <p class="slds-text-body_small">This policy is valid from the activation date and subject to the terms and conditions.</p>
                    </div>
                </div>

                <!-- Download Button -->
                <div class="slds-m-top_medium slds-text-align_center">
                    <lightning-button variant="brand" label="Download Policy Document" onclick={handleDownload} icon-name="utility:download" class="slds-m-right_small"></lightning-button>
                    <lightning-button variant="neutral" label="Done" onclick={handleDone}></lightning-button>
                </div>
            </div>
        </template>

        <!-- ERROR -->
        <template if:true={errorMessage}>
            <div class="slds-text-color_error slds-p-around_small">
                {errorMessage}
            </div>
        </template>
    </lightning-card>
</template>