<template>
    <lightning-card title="Insurance Onboarding">
        <!-- STEP: ACCOUNT -->
        <template if:true={isAccountStep}>
            <div class="slds-p-around_medium slds-grid slds-wrap slds-gutters">
                <div class="slds-col slds-size_1-of-1">
                    <lightning-radio-group
                        label="Client Type"
                        options={clientTypeOptions}
                        value={dto.clientType}
                        required
                        name="clientType"
                        type="radio"
                        onchange={handleClientTypeChange}>
                    </lightning-radio-group>
                </div>

                <!-- Person -->
                <template if:true={isPerson}>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input name="firstName" label="First Name" value={dto.firstName} onchange={handleInputChange} required></lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input name="lastName" label="Last Name" value={dto.lastName} onchange={handleInputChange} required></lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input type="date" name="birthDate" label="Birth Date" value={dto.birthDate} onchange={handleInputChange}></lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input name="driverLicense" label="Driver License" value={dto.driverLicense} onchange={handleInputChange}></lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input type="date" name="licenseIssuanceDate" label="License Issuance Date" value={dto.licenseIssuanceDate} onchange={handleInputChange}></lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input name="categoryLicense" label="License Category" value={dto.categoryLicense} onchange={handleInputChange}></lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input name="nationalId" label="National ID" value={dto.nationalId} onchange={handleInputChange}></lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input type="email" name="email" label="Email" value={dto.email} onchange={handleInputChange}></lightning-input>
                    </div>
                </template>

                <!-- Business -->
                <template if:true={isBusiness}>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input name="businessName" label="Business Name" value={dto.businessName} onchange={handleInputChange} required></lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input name="registerOfCommerce" label="Register of Commerce" value={dto.registerOfCommerce} onchange={handleInputChange}></lightning-input>
                    </div>
                </template>

                <!-- Common contact fields -->
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="phoneNumber" label="Phone" value={dto.phoneNumber} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="city" label="City" value={dto.city} onchange={handleInputChange}></lightning-input>
                </div>

                <div class="slds-col slds-size_1-of-1 slds-m-top_medium">
                    <lightning-button variant="neutral" label="Back" onclick={handleBack} disabled={isFirstStep} class="slds-m-right_small"></lightning-button>
                    <lightning-button variant="brand" label="Next" onclick={handleNext}></lightning-button>
                </div>
            </div>
        </template>

        <!-- STEP: DRIVER (Business only) -->
        <template if:true={isDriverStep}>
            <div class="slds-p-around_medium slds-grid slds-wrap slds-gutters">
                <div class="slds-col slds-size_1-of-1">
                    <h3 class="slds-text-heading_medium slds-m-bottom_small">Driver Information</h3>
                </div>
                
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="driverFirstName" label="Driver First Name" value={dto.driverFirstName} onchange={handleInputChange} required></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="driverLastName" label="Driver Last Name" value={dto.driverLastName} onchange={handleInputChange} required></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input type="date" name="birthDate" label="Birth Date" value={dto.birthDate} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="driverLicense" label="Driver License" value={dto.driverLicense} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input type="date" name="licenseIssuanceDate" label="License Issuance Date" value={dto.licenseIssuanceDate} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="nationalId" label="National ID" value={dto.nationalId} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input type="email" name="email" label="Email" value={dto.email} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="categoryLicense" label="License Category" value={dto.categoryLicense} onchange={handleInputChange}></lightning-input>
                </div>

                <div class="slds-col slds-size_1-of-1 slds-m-top_medium">
                    <lightning-button variant="neutral" label="Back" onclick={handleBack} class="slds-m-right_small"></lightning-button>
                    <lightning-button variant="brand" label="Next" onclick={handleNext}></lightning-button>
                </div>
            </div>
        </template>

        <!-- STEP: VEHICLE -->
        <template if:true={isVehicleStep}>
            <div class="slds-p-around_medium slds-grid slds-wrap slds-gutters">
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="vehiclePlate" label="Vehicle Plate" value={dto.vehiclePlate} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input type="checkbox" name="vehicleIsNew" label="Is New?" checked={dto.vehicleIsNew} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input type="date" name="vehicleStartDateOfCirculation" label="Start Date of Circulation" value={dto.vehicleStartDateOfCirculation} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="vehicleBodyType" label="Body Type" value={dto.vehicleBodyType} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input type="number" name="vehicleNumberOfPassengers" label="Number of Passengers" value={dto.vehicleNumberOfPassengers} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="vehicleBrand" label="Brand" value={dto.vehicleBrand} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input type="number" name="vehicleCylinder" label="Cylinder" value={dto.vehicleCylinder} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input type="number" name="vehicleFiscalHorsepower" label="Fiscal Horsepower" value={dto.vehicleFiscalHorsepower} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="vehicleUsage" label="Usage" value={dto.vehicleUsage} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="vehicleMake" label="Make" value={dto.vehicleMake} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="vehicleModel" label="Model" value={dto.vehicleModel} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input name="vehicleFuelType" label="Fuel Type" value={dto.vehicleFuelType} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input type="checkbox" name="vehicleTrailer" label="Has Trailer?" checked={dto.vehicleTrailer} onchange={handleInputChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <lightning-input type="number" name="vehicleValue" label="Estimated Value" value={dto.vehicleValue} onchange={handleInputChange}></lightning-input>
                </div>

                <div class="slds-col slds-size_1-of-1 slds-m-top_medium">
                    <lightning-button variant="neutral" label="Back" onclick={handleBack} class="slds-m-right_small"></lightning-button>
                    <lightning-button variant="brand" label="Next" onclick={handleNext}></lightning-button>
                </div>
            </div>
        </template>

        <!-- STEP: REVIEW -->
        <!-- STEP: REVIEW -->
        <template if:true={isReviewStep}>
            <div class="slds-p-around_medium">
                <p class="slds-text-heading_small slds-m-bottom_medium">Review Information</p>
                
                <!-- Account Information -->
                <div class="slds-box slds-m-bottom_medium">
                    <h3 class="slds-text-heading_small slds-m-bottom_small">
                        <lightning-icon icon-name="standard:account" size="small" class="slds-m-right_x-small"></lightning-icon>
                        Account Information
                    </h3>
                    <div class="slds-grid slds-wrap">
                        <template if:true={isPerson}>
                            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                                <strong>Name:</strong> {dto.firstName} {dto.lastName}
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                                <strong>Birth Date:</strong> {dto.birthDate}
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                                <strong>Driver License:</strong> {dto.driverLicense}
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                                <strong>National ID:</strong> {dto.nationalId}
                            </div>
                        </template>
                        
                        <template if:true={isBusiness}>
                            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                                <strong>Business Name:</strong> {dto.businessName}
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                                <strong>Register of Commerce:</strong> {dto.registerOfCommerce}
                            </div>
                        </template>
                        
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>Phone:</strong> {dto.phoneNumber}
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>City:</strong> {dto.city}
                        </div>
                    </div>
                </div>
                
                <!-- Driver Information (Business only) -->
                <template if:true={isBusiness}>
                    <div class="slds-box slds-m-bottom_medium">
                        <h3 class="slds-text-heading_small slds-m-bottom_small">
                            <lightning-icon icon-name="standard:contact" size="small" class="slds-m-right_x-small"></lightning-icon>
                            Driver Information
                        </h3>
                        <div class="slds-grid slds-wrap">
                            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                                <strong>Name:</strong> {dto.driverFirstName} {dto.driverLastName}
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                                <strong>Birth Date:</strong> {dto.birthDate}
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                                <strong>Driver License:</strong> {dto.driverLicense}
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                                <strong>National ID:</strong> {dto.nationalId}
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                                <strong>License Category:</strong> {dto.categoryLicense}
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                                <strong>Email:</strong> {dto.email}
                            </div>
                        </div>
                    </div>
                </template>
                
                <!-- Vehicle Information -->
                <div class="slds-box slds-m-bottom_medium">
                    <h3 class="slds-text-heading_small slds-m-bottom_small">
                        <lightning-icon icon-name="custom:custom26" size="small" class="slds-m-right_x-small"></lightning-icon>
                        Vehicle Information
                    </h3>
                    <div class="slds-grid slds-wrap">
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>Plate:</strong> {dto.vehiclePlate}
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>Is New:</strong> {vehicleIsNewLabel}
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>Brand:</strong> {dto.vehicleBrand}
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>Model:</strong> {dto.vehicleModel}
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>Make:</strong> {dto.vehicleMake}
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>Body Type:</strong> {dto.vehicleBodyType}
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>Fuel Type:</strong> {dto.vehicleFuelType}
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>Usage:</strong> {dto.vehicleUsage}
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>Fiscal Horsepower:</strong> {dto.vehicleFiscalHorsepower}
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>Cylinder:</strong> {dto.vehicleCylinder}
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>Passengers:</strong> {dto.vehicleNumberOfPassengers}
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>Value:</strong> {vehicleValueFormatted}
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>Has Trailer:</strong> {vehicleTrailerLabel}
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                            <strong>Start Date:</strong> {dto.vehicleStartDateOfCirculation}
                        </div>
                    </div>
                </div>
                
                <div class="slds-m-top_medium">
                    <lightning-button variant="neutral" label="Back" onclick={handleBack} class="slds-m-right_small"></lightning-button>
                    <lightning-button variant="brand" label="Next" onclick={handleNext}></lightning-button>
                </div>
            </div>
        </template>

        <!-- STEP: COVERAGES -->
        <template if:true={isCoveragesStep}>
            <div class="slds-p-around_medium">
                <lightning-dual-listbox
                    name="coverages"
                    label="Select Coverages"
                    source-label="Available"
                    selected-label="Selected"
                    field-level-help="Choose applicable coverages"
                    options={coverageOptions}
                    value={dto.selectedCoverageIds}
                    onchange={handleCoveragesChange}>
                </lightning-dual-listbox>

                <div class="slds-m-top_medium">
                    <lightning-button variant="neutral" label="Back" onclick={handleBack} class="slds-m-right_small"></lightning-button>
                    <lightning-button variant="brand" label="Next" onclick={handleNext}></lightning-button>
                </div>
            </div>
        </template>

        <!-- STEP: FINALIZE -->
        <template if:true={isFinalizeStep}>
            <div class="slds-p-around_medium">
                <p class="slds-text-heading_small">Finalize Onboarding</p>
                <p class="slds-m-vertical_small">Apex will create/update Policy, Contract and Contract Coverages.</p>
                <div class="slds-m-top_medium">
                    <lightning-button variant="neutral" label="Back" onclick={handleBack} class="slds-m-right_small"></lightning-button>
                    <lightning-button variant="brand" label="Save & Finish" onclick={handleNext}></lightning-button>
                </div>
            </div>
        </template>

        <!-- ERROR -->
        <template if:true={errorMessage}>
            <div class="slds-text-color_error slds-p-around_small">
                {errorMessage}
            </div>
        </template>
    </lightning-card>
</template>